<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Minesweeper Lite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .cell {
            aspect-ratio: 1 / 1;
            transition: all 0.1s ease;
        }

        .cell-hidden {
            background: linear-gradient(145deg, #e2e8f0, #cbd5e1);
            box-shadow: inset -2px -2px 0px #94a3b8, inset 2px 2px 0px #f8fafc;
        }

        .cell-revealed {
            background: #f1f5f9;
            box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1);
        }

        .digit-1 { color: #2563eb; }
        .digit-2 { color: #16a34a; }
        .digit-3 { color: #dc2626; }
        .digit-4 { color: #7c3aed; }
        .digit-5 { color: #991b1b; }
        .digit-6 { color: #0891b2; }
        .digit-7 { color: #1e293b; }
        .digit-8 { color: #64748b; }

        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
    <script>
        const manifest = {
            "name": "Minesweeper Lite",
            "short_name": "Minesweeper",
            "start_url": window.location.href,
            "display": "standalone",
            "background_color": "#f8fafc",
            "theme_color": "#0f172a",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fbbf24' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);
    </script>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200">
        <div class="bg-slate-900 p-6 text-white">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-xl font-bold flex items-center gap-2">
                    <i data-feather="target" class="text-yellow-400"></i>
                    Minesweeper Lite
                </h1>
                <div class="flex gap-2">
                    <button id="mute-btn" class="bg-slate-800 hover:bg-slate-700 p-2 rounded-xl transition-colors">
                        <i id="mute-icon" data-feather="volume-2" class="w-5 h-5"></i>
                    </button>
                    <button id="reset-btn" class="bg-slate-800 hover:bg-slate-700 p-2 rounded-xl transition-colors">
                        <i data-feather="rotate-cw" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <div class="bg-slate-800 p-3 rounded-2xl text-center">
                    <p class="text-xs text-slate-400 uppercase font-bold mb-1">Mines</p>
                    <p id="mine-count" class="text-xl font-mono text-yellow-400">000</p>
                </div>
                <div class="bg-slate-800 p-3 rounded-2xl text-center">
                    <p class="text-xs text-slate-400 uppercase font-bold mb-1">Time</p>
                    <p id="timer" class="text-xl font-mono text-white">000</p>
                </div>
                <div class="bg-slate-800 p-3 rounded-2xl text-center flex flex-col items-center justify-center">
                    <button id="mode-toggle" class="relative w-full h-full flex items-center justify-center gap-1 text-slate-300 hover:text-white transition-colors">
                        <i id="mode-icon" data-feather="mouse-pointer" class="w-5 h-5"></i>
                        <span id="mode-text" class="text-[10px] font-bold uppercase">Dig</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="p-4 bg-slate-100 overflow-x-auto">
            <div id="grid" class="grid gap-1 bg-slate-300 p-1 rounded-lg shadow-inner mx-auto" style="width: fit-content;">
            </div>
        </div>

        <div class="p-6 border-t border-slate-100 flex gap-2">
            <button class="difficulty-btn flex-1 py-2 px-3 rounded-xl bg-slate-100 text-slate-600 font-semibold text-sm hover:bg-slate-200 transition-colors" data-level="easy">Easy</button>
            <button class="difficulty-btn flex-1 py-2 px-3 rounded-xl bg-slate-100 text-slate-600 font-semibold text-sm hover:bg-slate-200 transition-colors" data-level="medium">Med</button>
            <button class="difficulty-btn flex-1 py-2 px-3 rounded-xl bg-slate-100 text-slate-600 font-semibold text-sm hover:bg-slate-200 transition-colors" data-level="hard">Hard</button>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-50 p-6">
        <div class="bg-white rounded-3xl p-8 w-full max-w-xs text-center shadow-2xl">
            <div id="modal-icon" class="mb-4 inline-block p-4 rounded-full bg-slate-100">
            </div>
            <h2 id="modal-title" class="text-2xl font-bold mb-2">Game Over</h2>
            <p id="modal-message" class="text-slate-500 mb-6">Better luck next time!</p>
            <button id="modal-close" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-transform active:scale-95">
                Play Again
            </button>
        </div>
    </div>

    <script>
        const CONFIG = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 12, cols: 12, mines: 25 },
            hard: { rows: 16, cols: 12, mines: 40 }
        };

        let currentLevel = 'easy';
        let board = [];
        let mineLocations = new Set();
        let revealedCount = 0;
        let flaggedCount = 0;
        let isGameOver = false;
        let timerInterval = null;
        let seconds = 0;
        let isFirstClick = true;
        let isFlagMode = false;
        let isMuted = false;

        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        const noiseSynth = new Tone.NoiseSynth({
            noise: { type: 'white' },
            envelope: { attack: 0.005, decay: 0.3, sustain: 0 }
        }).toDestination();
        const membraneSynth = new Tone.MembraneSynth().toDestination();

        const gridEl = document.getElementById('grid');
        const mineCountEl = document.getElementById('mine-count');
        const timerEl = document.getElementById('timer');
        const resetBtn = document.getElementById('reset-btn');
        const muteBtn = document.getElementById('mute-btn');
        const muteIcon = document.getElementById('mute-icon');
        const modeToggle = document.getElementById('mode-toggle');
        const modeIcon = document.getElementById('mode-icon');
        const modeText = document.getElementById('mode-text');
        const modal = document.getElementById('modal');

        function playSound(type) {
            if (isMuted) return;
            if (Tone.context.state !== 'running') Tone.start();

            switch(type) {
                case 'dig':
                    synth.triggerAttackRelease("C4", "32n", undefined, 0.1);
                    break;
                case 'flag':
                    synth.triggerAttackRelease("G4", "32n", undefined, 0.2);
                    break;
                case 'unflag':
                    synth.triggerAttackRelease("E4", "32n", undefined, 0.1);
                    break;
                case 'explode':
                    noiseSynth.triggerAttackRelease("2n");
                    membraneSynth.triggerAttackRelease("C1", "2n");
                    break;
                case 'win':
                    const now = Tone.now();
                    synth.triggerAttackRelease("C4", "8n", now);
                    synth.triggerAttackRelease("E4", "8n", now + 0.1);
                    synth.triggerAttackRelease("G4", "8n", now + 0.2);
                    synth.triggerAttackRelease("C5", "4n", now + 0.3);
                    break;
                case 'click':
                    membraneSynth.triggerAttackRelease("G2", "64n", undefined, 0.1);
                    break;
            }
        }

        function init() {
            feather.replace();
            setupDifficultyButtons();
            resetBtn.addEventListener('click', () => {
                playSound('click');
                createBoard(currentLevel);
            });
            muteBtn.addEventListener('click', () => {
                isMuted = !isMuted;
                muteIcon.setAttribute('data-feather', isMuted ? 'volume-x' : 'volume-2');
                feather.replace();
            });
            modeToggle.addEventListener('click', () => {
                playSound('click');
                toggleMode();
            });
            document.getElementById('modal-close').addEventListener('click', () => {
                playSound('click');
                modal.classList.add('hidden');
                createBoard(currentLevel);
            });
            createBoard(currentLevel);
        }

        function toggleMode() {
            isFlagMode = !isFlagMode;
            modeText.innerText = isFlagMode ? 'Flag' : 'Dig';
            modeIcon.setAttribute('data-feather', isFlagMode ? 'flag' : 'mouse-pointer');
            modeToggle.classList.toggle('text-yellow-400', isFlagMode);
            modeToggle.classList.toggle('text-slate-300', !isFlagMode);
            feather.replace();
        }

        function setupDifficultyButtons() {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    playSound('click');
                    const level = btn.getAttribute('data-level');
                    document.querySelectorAll('.difficulty-btn').forEach(b => {
                        b.classList.remove('bg-slate-900', 'text-white');
                        b.classList.add('bg-slate-100', 'text-slate-600');
                    });
                    btn.classList.remove('bg-slate-100', 'text-slate-600');
                    btn.classList.add('bg-slate-900', 'text-white');
                    createBoard(level);
                });
            });
            const initialBtn = document.querySelector('[data-level="easy"]');
            initialBtn.classList.remove('bg-slate-100', 'text-slate-600');
            initialBtn.classList.add('bg-slate-900', 'text-white');
        }

        function createBoard(level) {
            currentLevel = level;
            const { rows, cols, mines } = CONFIG[level];
            
            clearInterval(timerInterval);
            isGameOver = false;
            isFirstClick = true;
            revealedCount = 0;
            flaggedCount = 0;
            seconds = 0;
            board = [];
            mineLocations.clear();
            
            timerEl.innerText = '000';
            mineCountEl.innerText = mines.toString().padStart(3, '0');
            
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
            const containerWidth = Math.min(window.innerWidth - 48, 400);
            const cellSize = Math.floor(containerWidth / cols);
            gridEl.style.width = `${cellSize * cols + 8}px`;

            for (let r = 0; r < rows; r++) {
                board[r] = [];
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell cell-hidden rounded-md flex items-center justify-center text-sm font-bold cursor-pointer select-none';
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    
                    cell.addEventListener('mousedown', () => {
                        if (Tone.context.state !== 'running') Tone.start();
                    });

                    cell.addEventListener('click', (e) => handleCellAction(r, c, false));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleCellAction(r, c, true);
                    });

                    gridEl.appendChild(cell);
                    board[r][c] = {
                        mine: false,
                        revealed: false,
                        flagged: false,
                        count: 0,
                        el: cell
                    };
                }
            }
        }

        function placeMines(excludeR, excludeC) {
            const { rows, cols, mines } = CONFIG[currentLevel];
            let placed = 0;
            while (placed < mines) {
                let r = Math.floor(Math.random() * rows);
                let c = Math.floor(Math.random() * cols);
                let key = `${r}-${c}`;
                
                if (!mineLocations.has(key) && (Math.abs(r - excludeR) > 1 || Math.abs(c - excludeC) > 1)) {
                    mineLocations.add(key);
                    board[r][c].mine = true;
                    placed++;
                }
            }

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (!board[r][c].mine) {
                        board[r][c].count = getNeighbors(r, c).filter(n => board[n.r][n.c].mine).length;
                    }
                }
            }
        }

        function getNeighbors(r, c) {
            const { rows, cols } = CONFIG[currentLevel];
            const neighbors = [];
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    let nr = r + dr;
                    let nc = c + dc;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                        neighbors.push({ r: nr, c: nc });
                    }
                }
            }
            return neighbors;
        }

        function handleCellAction(r, c, isRightClick) {
            if (isGameOver || board[r][c].revealed) return;

            if ((isFlagMode && !isRightClick) || isRightClick) {
                toggleFlag(r, c);
                return;
            }

            if (board[r][c].flagged) return;

            if (isFirstClick) {
                isFirstClick = false;
                placeMines(r, c);
                startTimer();
            }

            revealCell(r, c);
        }

        function toggleFlag(r, c) {
            const cell = board[r][c];
            cell.flagged = !cell.flagged;
            playSound(cell.flagged ? 'flag' : 'unflag');
            cell.el.innerHTML = cell.flagged ? '<i data-feather="flag" class="w-3 h-3 text-red-500"></i>' : '';
            if (cell.flagged) feather.replace();
            
            flaggedCount += cell.flagged ? 1 : -1;
            const remaining = CONFIG[currentLevel].mines - flaggedCount;
            mineCountEl.innerText = Math.max(0, remaining).toString().padStart(3, '0');
        }

        function revealCell(r, c, silent = false) {
            const cell = board[r][c];
            if (cell.revealed || cell.flagged) return;

            cell.revealed = true;
            cell.el.classList.remove('cell-hidden');
            cell.el.classList.add('cell-revealed');
            revealedCount++;

            if (cell.mine) {
                playSound('explode');
                endGame(false);
                cell.el.classList.add('bg-red-500', 'shake');
                cell.el.innerHTML = '<i data-feather="bomb" class="w-4 h-4 text-white"></i>';
                feather.replace();
                return;
            }

            if (!silent) playSound('dig');

            if (cell.count > 0) {
                cell.el.innerText = cell.count;
                cell.el.classList.add(`digit-${cell.count}`);
            } else {
                getNeighbors(r, c).forEach(n => revealCell(n.r, n.c, true));
            }

            checkWin();
        }

        function checkWin() {
            const { rows, cols, mines } = CONFIG[currentLevel];
            if (revealedCount === (rows * cols) - mines) {
                playSound('win');
                endGame(true);
            }
        }

        function endGame(isWin) {
            isGameOver = true;
            clearInterval(timerInterval);

            mineLocations.forEach(key => {
                const [r, c] = key.split('-').map(Number);
                const cell = board[r][c];
                if (!cell.revealed && !cell.flagged) {
                    cell.el.innerHTML = `<i data-feather="bomb" class="w-3 h-3 text-slate-400"></i>`;
                }
            });
            feather.replace();

            setTimeout(() => {
                const modalTitle = document.getElementById('modal-title');
                const modalMsg = document.getElementById('modal-message');
                const modalIcon = document.getElementById('modal-icon');

                if (isWin) {
                    modalTitle.innerText = "You Won!";
                    modalMsg.innerText = `Impressive! You cleared the field in ${seconds} seconds.`;
                    modalIcon.innerHTML = `<i data-feather="award" class="w-12 h-12 text-yellow-500"></i>`;
                } else {
                    modalTitle.innerText = "Game Over";
                    modalMsg.innerText = "Kaboom! Watch your step next time.";
                    modalIcon.innerHTML = `<i data-feather="frown" class="w-12 h-12 text-slate-500"></i>`;
                }
                modal.classList.remove('hidden');
                feather.replace();
            }, 800);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                seconds++;
                timerEl.innerText = Math.min(999, seconds).toString().padStart(3, '0');
            }, 1000);
        }

        window.onload = init;
    </script>
</body>
</html>
